---
title: "Titanic"
author: "Dongdong Zhang"
date: "11/06/2018"
output: html_document
---

```{r}
# library
library(ggplot2)
library(ggthemes)
library(scales)
library(plyr)
library(dplyr)
library(mice)
library(randomForest)
library(party)
library(corrplot)

```


```{r}
train = read.csv("/Users/allenzhang/Desktop/kaggle_data_set/Titanic/train.csv")
test = read.csv("/Users/allenzhang/Desktop/kaggle_data_set/Titanic/test.csv")
```

```{r}
str(train)
str(test)
data <- bind_rows(train,test)
summary(data)
```

```{r}
sapply(data,function(x) sum(is.na(x)))
sapply(data,function(x) sum(x == ""))
```


```{r}
Embarked.na <- data$Embarked
which(Embarked.na %in% "")
```

```{r}
data_62 <- data[data$PassengerId == 62,]
data_830 <- data[data$PassengerId == 830,]
data_62
data_830
```

```{r}
ggplot(data[!is.na(data$Embarked),],aes(x=Embarked, y=Fare, fill=factor(Pclass))) +
  geom_boxplot() + 
  geom_hline(aes(yintercept=80), color='red', linetype='dashed', lwd=2) +
  scale_y_continuous(labels=dollar_format())

```


```{r}
data$Embarked[c(62,830)] <- "C"
sapply(data,function(x) sum(x == ""))
```


```{r}
Fare.na = is.na(data$Fare)
which(Fare.na %in% TRUE)
```


```{r}
data_1044 = data[data$PassengerId == 1044,]
data_1044
```


```{r}
ggplot(data[data$Embarked=='S' & data$Pclass == 3,],aes(x=Embarked, y=Fare, fill=factor(Pclass))) +
  geom_boxplot() + 
  geom_hline(aes(yintercept=80), color='red', linetype='dashed', lwd=2) +
  scale_y_continuous(labels=dollar_format())
```

```{r}
b = median(data$Fare[data$Embarked == 'S' & data$Pclass ==3], na.rm = T)

```


```{r}
data$Fare[1044] = 8.05
sapply(data, function(x) sum(is.na(x)))
```

```{r}
data[is.na(data$Age),]
```


```{r}
set.seed(129)

ss <- c('PassengerId','Name','Ticket','Cabin','family','Surname','Survived')
mice_age <- mice(data[,!names(data) %in% ss],method = 'rf')
mice_output <- complete(mice_age)

```

```{r}

par(mfrow=c(1,2))
hist(data$Age,freq = F,main = 'Age:ORiginal Data',col='darkblue',ylim = c(0,0.04))
hist(mice_output$Age,freq = F,main = 'Age:MICE Output',col = 'skyblue',ylim = c(0,0.04))


```

```{r}
data$Age <- mice_output$Age

```

```{r}
sapply(data,function(x) sum(is.na(x)))
sapply(data,function(x) sum(x == ""))
```


### Analysis
```{r}

data$Survived <- factor(data$Survived)
ggplot(data = data[1:nrow(train),], mapping = aes(x = Pclass, y = ..count.., fill=Survived)) + 
  geom_bar(stat = "count", position='dodge') + 
  xlab('Pclass') + 
  ylab('Count') + 
  ggtitle('Different Pclass impact survived') + 
  scale_fill_manual(values=c("#FF0000", "#00FF00")) +
  geom_text(stat = "count", aes(label = ..count..), position=position_dodge(width=1), , vjust=-0.5) + 
  theme(plot.title = element_text(hjust = 0.5), legend.position="bottom")
```

```{r}

```


